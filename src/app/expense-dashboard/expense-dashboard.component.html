<div class="container py-4 dashboard">
  <!-- Title -->
  <h2 class="text-center mb-4 fw-bold text-primary">Expense Tracker Dashboard</h2>

  <!-- Filters and Export -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div class="d-flex align-items-center">
      <label class="me-2 fw-semibold">Year:</label>
      <select class="form-select me-3 w-auto" [(ngModel)]="selectedYear" (change)="filterByYearAndMonth()">
        <option *ngFor="let year of availableYears" [value]="year">{{ year }}</option>
      </select>

      <label class="me-2 fw-semibold">Month:</label>
      <select class="form-select w-auto" [(ngModel)]="selectedMonth" (change)="filterByYearAndMonth()">
        <option *ngFor="let month of availableMonths" [value]="month">{{ month }}</option>
      </select>
    </div>

    <button class="btn btn-outline-primary btn-sm" (click)="exportCSV()">Export CSV</button>
  </div>

  <!-- Summary Cards -->
  <div class="row mb-4">
    <div class="col-12 mb-3">
      <div class="card shadow-sm border-0 rounded-3 text-center bg-light">
        <div class="card-body">
          <h5 class="card-title">Total Balance</h5>
          <p class="card-text display-6 fw-semibold" [style.color]="totalIncome - totalExpense >= 0 ? incomeColor : expenseColor">
            ₹ {{ totalIncome - totalExpense }}
          </p>
        </div>
      </div>
    </div>

    <div class="col-md-6 mb-3">
      <div class="card shadow-sm border-0 rounded-3 text-center">
        <div class="card-body">
          <h5 class="card-title">Total Income</h5>
          <p class="card-text display-6 fw-bold" [style.color]="incomeColor">₹ {{ totalIncome }}</p>
        </div>
      </div>
    </div>

    <div class="col-md-6 mb-3">
      <div class="card shadow-sm border-0 rounded-3 text-center">
        <div class="card-body">
          <h5 class="card-title">Total Expense</h5>
          <p class="card-text display-6 fw-bold" [style.color]="expenseColor">₹ {{ totalExpense }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts -->
  <div class="row mb-4">
    <div class="col-md-6 mb-3">
      <div class="card shadow-sm border-0 rounded-3">
        <div class="card-header bg-white fw-semibold d-flex justify-content-between">
          <span>Income vs Expense</span>
          <small><span class="badge bg-success">Income</span> <span class="badge bg-danger">Expense</span></small>
        </div>
        <div class="card-body">
          <app-pie-chart
            [income]="totalIncome"
            [expense]="totalExpense"
            [incomeColor]="incomeColor"
            [expenseColor]="expenseColor">
          </app-pie-chart>
        </div>
      </div>
    </div>

    <div class="col-md-6 mb-3">
      <div class="card shadow-sm border-0 rounded-3">
        <div class="card-header bg-white fw-semibold d-flex justify-content-between">
          <span>Item Breakdown</span>
          <small><span class="badge bg-success">Income</span> <span class="badge bg-danger">Expense</span></small>
        </div>
        <div class="card-body">
          <app-bar-chart
            [tableData]="filteredData"
            [incomeColor]="incomeColor"
            [expenseColor]="expenseColor">
          </app-bar-chart>
        </div>
      </div>
    </div>
  </div>

  <!-- Data Table -->
  <div class="card shadow-sm border-0 rounded-3 mb-5">
    <div class="card-header d-flex justify-content-between align-items-center bg-white fw-semibold">
      <h5 class="mb-0">Transaction Table</h5>
      <button class="btn btn-success btn-sm" (click)="openModal()">+ Add</button>
    </div>
    <div class="card-body p-0">
      <table class="table table-striped mb-0">
        <thead class="table-light">
          <tr>
            <th>#</th>
            <th>Type</th>
            <th>Name</th>
            <th>Amount</th>
            <th>Date</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngIf="filteredData.length === 0">
            <td colspan="6" class="text-center text-muted py-4">
              No data available for selected filter.
            </td>
          </tr>
          <tr *ngFor="let item of filteredData; let i = index">
            <td>{{ i + 1 }}</td>
            <td><span class="badge" [ngClass]="{ 'bg-success': item.type === 'Income', 'bg-danger': item.type === 'Expense' }">{{ item.type }}</span></td>
            <td>{{ item.name }}</td>
            <td>₹ {{ item.amount }}</td>
            <td>{{ item.date | date: 'mediumDate' }}</td>
            <td>
              <button class="btn btn-sm btn-outline-primary me-1" (click)="openModal(i)">Edit</button>
              <button class="btn btn-sm btn-outline-danger" (click)="deleteItem(i)">Delete</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Modal -->
  <app-expense
  *ngIf="showModal"
  [editData]="isEditMode ? tableData[editIndex] : null"
  (save)="handleSave($event)"
  (cancel)="showModal = false">
</app-expense>
</div>
